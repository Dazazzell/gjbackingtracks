<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gypsy Jazz Backing Tracks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- DataTables + jQuery CDN -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

  <!-- PapaParse for CSV parsing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    table.dataTable td {
      vertical-align: middle;
    }

    .star {
      cursor: pointer;
      font-size: 1.2em;
      color: lightgray;
    }

    .star.fav {
      color: gold;
    }

    .filter-buttons {
      margin-bottom: 10px;
      text-align: center;
    }

    .filter-buttons button {
      margin: 0 5px;
      padding: 5px 10px;
    }

    .filter-buttons button.active {
      background-color: #007bff;
      color: white;
      border: none;
    }
  </style>
</head>
<body>

  <h1>Gypsy Jazz Backing Tracks</h1>

  <div class="filter-buttons">
    <button data-filter="*" class="active">All</button>
    <button data-filter="Soundslice">Soundslice</button>
    <button data-filter="Youtube">YouTube</button>
    <button data-filter="Favourite">â˜… Favourites</button>
  </div>

  <table id="myTable" class="display" style="width:100%">
    <thead>
      <tr>
        <th>Song</th>
        <th>Type</th>
        <th>Key</th>
        <th>Details</th>
        <th>Fav</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    function loadFavourites() {
      const favs = localStorage.getItem('favourites');
      return favs ? JSON.parse(favs) : [];
    }

    function saveFavourites(favs) {
      localStorage.setItem('favourites', JSON.stringify(favs));
    }

    function initTable() {
      const favs = loadFavourites();

      $('#myTable tbody tr').each(function() {
        const row = $(this);
        const songUrl = row.find('td:first-child a').attr('href');

        if (favs.includes(songUrl)) {
          row.find('.star').addClass('fav');
          row.find('td:last-child span:first-child').text('1');
        }
      });

      const table = $('#myTable').DataTable({
        order: [[0, 'asc']],
        columnDefs: [{ targets: 4, orderData: [4] }]
      });

      // Filter buttons
      $('.filter-buttons button').on('click', function () {
        $('.filter-buttons button').removeClass('active');
        $(this).addClass('active');
        const filter = $(this).data('filter');

        if (filter === '*') {
          table.search('').draw();
        } else if (filter === 'Favourite') {
          table
            .rows()
            .every(function () {
              const fav = $(this.node()).find('td:last-child span:first-child').text();
              this.visible(fav === '1');
            });
        } else {
          table
            .column(1)
            .search(filter)
            .draw();
        }
      });

      // Toggle favorite star
      $('#myTable tbody').on('click', '.star', function () {
        const star = $(this);
        const row = star.closest('tr');
        const songUrl = row.find('td:first-child a').attr('href');
        let favs = loadFavourites();

        if (star.hasClass('fav')) {
          star.removeClass('fav');
          favs = favs.filter(f => f !== songUrl);
          row.find('td:last-child span:first-child').text('0');
        } else {
          star.addClass('fav');
          favs.push(songUrl);
          row.find('td:last-child span:first-child').text('1');
        }

        saveFavourites(favs);
      });
    }

    $(document).ready(() => {
      Papa.parse('tracks.csv', {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function (results) {
          const data = results.data;
          data.forEach(row => {
            const favHidden = '<span style="display:none;">0</span>';
            const starSpan = '<span class="star">&#9733;</span>';
            const link = row.URL
              ? `<a href="${row.URL}" target="_blank">${row.Song}</a>`
              : row.Song;

            $('#myTable tbody').append(`
              <tr>
                <td>${link}</td>
                <td>${row.Type}</td>
                <td>${row.Key}</td>
                <td>${row.Details}</td>
                <td>${favHidden}${starSpan}</td>
              </tr>
            `);
          });

          initTable();
        }
      });
    });
  </script>

</body>
</html>
